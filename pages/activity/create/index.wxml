<view class="container">
  <van-form bind:submit="onSubmit">
    <!-- 基本信息 -->
    <van-cell-group title="基本信息">
      <van-field
        name="title"
        label="活动标题"
        placeholder="请输入活动标题"
        model:value="{{ activityTitle }}"
        rules="{{ [{required: true, message: '请输入活动标题'}] }}"
      />
      
      <van-field
        name="type"
        label="活动类型"
        placeholder="请选择活动类型"
        readonly
        value="{{ activityType }}"
        bindtap="showActivityTypePicker"
        rules="{{ [{required: true, message: '请选择活动类型'}] }}"
      />

      <van-field
        name="maxParticipants"
        label="人数限制"
        type="number"
        value="{{ maxParticipants }}"
        placeholder="请输入人数限制"
        rules="{{ [{required: true, message: '请输入人数限制'}] }}"
      />
    </van-cell-group>

    <!-- 活动设置 -->
    <van-cell-group title="活动设置">
      <van-field
        name="date"
        label="活动日期"
        placeholder="请选择活动日期"
        readonly
        value="{{ activityDate }}"
        bindtap="showDatePicker"
        rules="{{ [{required: true, message: '请选择活动日期'}] }}"
      />
      
      <van-field
        name="time"
        label="活动时间"
        placeholder="请选择活动时间"
        readonly
        value="{{ activityTime }}"
        bindtap="showTimePicker"
        rules="{{ [{required: true, message: '请选择活动时间'}] }}"
      />
      
      <van-field
        name="location"
        label="活动地点"
        placeholder="请输入活动地点"
        readonly
        value="{{ location }}"
        bindtap="showLocationPicker"
        rules="{{ [{required: true, message: '请选择活动地点'}] }}"
      />
    </van-cell-group>

    <!-- 封面上传 -->
    <view class="upload-section">
      <view class="section-title">活动封面</view>
      <van-uploader
        file-list="{{ fileList }}"
        bind:after-read="afterRead"
        bind:delete="deleteImage"
        max-count="1"
      />
    </view>

    <!-- 活动详情 -->
    <van-cell-group title="活动详情">
      <van-field
        name="details"
        type="textarea"
        placeholder="请输入活动详情"
        autosize="{{ { minHeight: 100, maxHeight: 200 } }}"
        model:value="{{ activityDetails }}"
        rules="{{ [{required: true, message: '请输入活动详情'}] }}"
      />
    </van-cell-group>

    <!-- 提交按钮 -->
    <view class="submit-btn">
      <van-button round block type="primary" form-type="submit">创建活动</van-button>
    </view>
  </van-form>

  <!-- 活动类型选择器 -->
  <van-popup show="{{ showActivityTypePicker }}" position="bottom" bind:close="closeActivityTypePicker">
    <van-picker
      columns="{{ activityTypes }}"
      bind:confirm="onActivityTypeConfirm"
      bind:cancel="closeActivityTypePicker"
      show-toolbar
    />
  </van-popup>

  <!-- 日期选择器 -->
  <van-popup show="{{ showDatePicker }}" position="bottom" bind:close="closeDatePicker">
    <van-datetime-picker
      type="date"
      value="{{ currentDate }}"
      min-date="{{ minDate }}"
      bind:confirm="onDateConfirm"
      bind:cancel="closeDatePicker"
    />
  </van-popup>

  <!-- 时间选择器 -->
  <van-popup show="{{ showTimePicker }}" position="bottom" bind:close="closeTimePicker">
    <van-datetime-picker
      type="time"
      value="{{ currentTime }}"
      bind:confirm="onTimeConfirm"
      bind:cancel="closeTimePicker"
    />
  </van-popup>

  <!-- 地图选择器 -->
  <van-popup show="{{ showLocationPicker }}" position="bottom" bind:close="closeLocationPicker">
    <map
      id="locationMap"
      style="width: 100%; height: 300px;"
      latitude="{{ latitude }}"
      longitude="{{ longitude }}"
      show-location
      bindtap="chooseLocation"
    ></map>
  </van-popup>
</view>